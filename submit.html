<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>Submit Ideas</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
  
<div class="bg-fx" id="bgfx"></div>
<div class="scanlines"></div>
<div class="app">
<div class="terminal-mark">Hello World<span class="cursor">_</span></div>

  
<nav>
<a href="submit.html">Submit</a>
<a href="vote.html">Vote</a>
<a href="results.html">Results</a>
</nav>

<h1>Submit Ideas</h1>

<div class="card">
<label>Alias</label>
  
<input id="alias" placeholder="e.g. mintpanda" autocomplete="off">

  
<p id="aliasStatus" class="muted"></p>


<div id="ideas"></div>

<button id="submitBtn">Submit</button>
<p id="msg"></p>
</div>


<script>
// ===== Alias (Submit page) =====
const aliasInput = document.getElementById("alias");
const aliasStatus = document.getElementById("aliasStatus");

const STORAGE_KEY = "claimedAlias";

// Save manually typed alias so it carries over to Vote
if(aliasInput){
  aliasInput.addEventListener("input", ()=>{
    const v = aliasInput.value.trim();
    if(v) localStorage.setItem(STORAGE_KEY, v);
  });
}

// Auto-fill if already saved
const saved = localStorage.getItem(STORAGE_KEY);
if(saved && aliasInput){
  aliasInput.value = saved;
  if(aliasStatus) aliasStatus.textContent = "Alias saved âœ”";
}

// Optional reset button (keep if you like)
const resetBtn = document.getElementById("resetAlias");
if(resetBtn){
  resetBtn.addEventListener("click", ()=>{
    localStorage.removeItem("claimedAlias");
    localStorage.removeItem("usedAliases");
    if(aliasStatus) aliasStatus.textContent = "Alias cleared. Type a new one âœ¨";
    if(aliasInput) aliasInput.value = "";
  });
}

// ===== App script API =====
const API_URL = "https://script.google.com/macros/s/AKfycbxmH6wodw-LA55_cnFFNp4G7n2WeFh6-fKDaFjAuh3e3mJOuOtiQugfWqnPvT_9SJLCPA/exec";
const API_KEY = "class9";

const ideasDiv = document.getElementById("ideas");
const msg = document.getElementById("msg");

// Build 3 idea inputs
for(let i=1;i<=3;i++){
  const box = document.createElement("div");
  box.className = "card";
  box.innerHTML = `
    <b>Idea ${i}</b>
    <label>Title</label>
    <input class="title" placeholder="e.g. Potion Shop Sim" />
    <label>Description</label>
    <textarea class="desc" placeholder="1â€“3 sentences"></textarea>
  `;
  ideasDiv.appendChild(box);
}

// Submit handler
document.getElementById("submitBtn").onclick = async ()=>{
  const btn = document.getElementById("submitBtn");
  const alias = document.getElementById("alias").value.trim();
  const titles = [...document.querySelectorAll(".title")];
  const descs = [...document.querySelectorAll(".desc")];

  msg.textContent = "";

  if(!alias){
    msg.textContent = "Enter an alias first âœ¨";
    return;
  }

  btn.disabled = true;
  btn.textContent = "Submittingâ€¦";
  msg.innerHTML = "Uploadingâ€¦ <span class='spinner'></span>";

  let sent = 0;

  try{
    for(let i=0;i<titles.length;i++){
      const t = titles[i].value.trim();
      if(!t) continue;

      const payload = {
        type: "idea",
        apiKey: API_KEY,
        alias: alias,
        title: t,
        description: descs[i].value.trim()
      };

      const r = await fetch(API_URL, { method:"POST", body: JSON.stringify(payload) });
      const data = await r.json();
      if(!data.ok) throw new Error(data.error || "submit failed");

      sent++;
    }

    if(sent === 0){
      msg.textContent = "Add at least 1 idea title ðŸ“";
      return;
    }

    msg.textContent = `Submitted! âœ…  +${sent * 5} Creativity XP ðŸŒŸ`;

  }catch(e){
    msg.textContent = "Error: " + e.message;
  }finally{
    btn.disabled = false;
    btn.textContent = "Submit";
  }
};
</script>

</div>
  
<div class="pixel-pet" id="pixelPet" title="click me"></div>

  <script>
const pet = document.getElementById("pixelPet");
if(pet){
  pet.addEventListener("click", ()=>{
    pet.classList.remove("jump");
    void pet.offsetWidth;
    pet.classList.add("jump");
  });
}
</script>


</body>
</html>
