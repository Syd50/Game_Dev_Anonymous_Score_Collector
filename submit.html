<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>Submit Ideas</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
  
<div class="bg-fx" id="bgfx"></div>
<div class="scanlines"></div>
<div class="app">
<div class="terminal-mark">Hello World<span class="cursor">_</span></div>

  
<nav>
<a href="submit.html">Submit</a>
<a href="vote.html">Vote</a>
<a href="results.html">Results</a>
</nav>

<h1>Submit Ideas</h1>

<div class="card">
<label>Alias</label>
  
<div class="alias-row">
  <input id="alias" placeholder="e.g. mintpanda" autocomplete="off">
  <button type="button" id="genAlias">ðŸŽ² Random</button>
  <button type="button" id="resetAlias">â™» Reset</button>
</div>


  
<p id="aliasStatus" class="muted"></p>


<div id="ideas"></div>

<button id="submitBtn">Submit</button>
<p id="msg"></p>
</div>


<script>
// ===== Alias generator (Submit page) =====
const aliasInput = document.getElementById("alias");
const aliasStatus = document.getElementById("aliasStatus");
const btnGen = document.getElementById("genAlias");

const aliasPool = [
  "PixelWizard","DebugDuck","ShaderSlayer","404Knight","NullPointer",
  "ByteBard","ConsoleCat","LoopGoblin","SyntaxSamurai","CrashMage",
  "QuantumPotato","BinaryBunny","GhostCompiler","BitBandit","RAMRogue",
  "KernelKitten","TurboToad","GlitchGnome","NeonNoodle","AIAlchemist",
  "StackSprite","CosmicCoder","NanoNinja","PacketPirate","LogicLizard",
  "OverclockOwl","CompileDragon","ScriptSprite","CyberSquirrel","RuntimeRaccoon"
];

const STORAGE_KEY = "claimedAlias";

// Save manually typed alias too (so it carries over to Vote)
if(aliasInput){
  aliasInput.addEventListener("input", ()=>{
    const v = aliasInput.value.trim();
    if(v) localStorage.setItem(STORAGE_KEY, v);
  });
}

// auto-fill if already chosen
const saved = localStorage.getItem(STORAGE_KEY);
if(saved && aliasInput){
  aliasInput.value = saved;
  if(aliasStatus) aliasStatus.textContent = "Alias locked in âœ”";
}

if(btnGen && aliasInput){
  btnGen.addEventListener("click", ()=>{
    if(localStorage.getItem(STORAGE_KEY)){
      if(aliasStatus) aliasStatus.textContent = `Alias locked: ${aliasInput.value} âœ”`;
      return;
    }

    const used = JSON.parse(localStorage.getItem("usedAliases") || "[]");
    const available = aliasPool.filter(a=>!used.includes(a));

    if(!available.length){
      if(aliasStatus) aliasStatus.textContent = "All aliases taken ðŸ˜±";
      return;
    }

    const pick = available[Math.floor(Math.random()*available.length)];
    aliasInput.value = pick;

    localStorage.setItem(STORAGE_KEY, pick);
    used.push(pick);
    localStorage.setItem("usedAliases", JSON.stringify(used));

    if(aliasStatus) aliasStatus.textContent = "Codename assigned ðŸŽ®";
    btnGen.textContent = "âœ”";
    setTimeout(()=> btnGen.textContent = "ðŸŽ² Random", 900);
  });
}

// ===== App script API =====
const API_URL = "https://script.google.com/macros/s/AKfycbxmH6wodw-LA55_cnFFNp4G7n2WeFh6-fKDaFjAuh3e3mJOuOtiQugfWqnPvT_9SJLCPA/exec";
const API_KEY = "class9";

const ideasDiv = document.getElementById("ideas");
const msg = document.getElementById("msg");

// Build 3 idea inputs
for(let i=1;i<=3;i++){
  const box = document.createElement("div");
  box.className = "card";
  box.innerHTML = `
    <b>Idea ${i}</b>
    <label>Title</label>
    <input class="title" placeholder="e.g. Potion Shop Sim" />
    <label>Description</label>
    <textarea class="desc" placeholder="1â€“3 sentences"></textarea>
  `;
  ideasDiv.appendChild(box);
}

// Submit handler
document.getElementById("submitBtn").onclick = async ()=>{
  const btn = document.getElementById("submitBtn");
  const alias = document.getElementById("alias").value.trim();
  const titles = [...document.querySelectorAll(".title")];
  const descs = [...document.querySelectorAll(".desc")];

  msg.textContent = "";

  if(!alias){
    msg.textContent = "Enter an alias first âœ¨";
    return;
  }

  btn.disabled = true;
  btn.textContent = "Submittingâ€¦";
  msg.innerHTML = "Uploadingâ€¦ <span class='spinner'></span>";

  let sent = 0;

  try{
    for(let i=0;i<titles.length;i++){
      const t = titles[i].value.trim();
      if(!t) continue;

      const payload = {
        type: "idea",
        apiKey: API_KEY,
        alias: alias,
        title: t,
        description: descs[i].value.trim()
      };

      const r = await fetch(API_URL, { method:"POST", body: JSON.stringify(payload) });
      const data = await r.json();
      if(!data.ok) throw new Error(data.error || "submit failed");

      sent++;
    }

    if(sent === 0){
      msg.textContent = "Add at least 1 idea title ðŸ“";
      return;
    }

    msg.textContent = `Submitted! âœ…  +${sent * 5} Creativity XP ðŸŒŸ`;

  }catch(e){
    msg.textContent = "Error: " + e.message;
  }finally{
    btn.disabled = false;
    btn.textContent = "Submit";
  }
};



     
                                // Background pixels
                                // (function makePixels(){
                                      
                                //  const host = document.getElementById("bgfx");
                                // if(!host) return;
                                //  const count = 26;
                                //   for(let i=0;i<count;i++){
                                //   const d = document.createElement("div");
                                //  d.className = "pixel" + (Math.random() < 0.35 ? " p2" : "");
                                //   d.style.left = Math.floor(Math.random()*100) + "vw";
                                //   d.style.animationDelay = (Math.random()*10).toFixed(2) + "s";
                                //   d.style.opacity = (0.07 + Math.random()*0.12).toFixed(2);
                                //   d.style.transform = `translateY(${100 + Math.random()*60}vh)`;
                                //  host.appendChild(d);
                                //  }
                                //   })(); 

// TEMP reset button for testing
const resetBtn = document.getElementById("resetAlias");

if(resetBtn){
  resetBtn.addEventListener("click", ()=>{
    localStorage.removeItem("claimedAlias");
    localStorage.removeItem("usedAliases");
    location.reload();
  });
}

  
</script>
</div>
  
<div class="pixel-pet" id="pixelPet" title="click me"></div>

  <script>
const pet = document.getElementById("pixelPet");
if(pet){
  pet.addEventListener("click", ()=>{
    pet.classList.remove("jump");
    void pet.offsetWidth;
    pet.classList.add("jump");
  });
}
</script>


</body>
</html>
